import{_ as V,l as k,h as w,a as u,o as i,c as a,d as e,b as n,w as x,F as v,j as C,f as b,i as P,n as U,v as A,M as E,t as _,p as T}from"./index-62ca245e.js";import{A as D}from"./AlertModalComponent-d4f00c71.js";import{P as L}from"./PaginationComponent-207b2ac4.js";const{VITE_API:S,VITE_PATH:N}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"sophiee22",BASE_URL:"/vue-live-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},F={data(){return{loadingItem:"",productModal:{},temp:{imagesUrl:[""]}}},methods:{showProductModal(l={imagesUrl:[""]}){this.temp={...l},this.productModal.show()},hideProductModal(){this.productModal.hide(),this.temp={imagesUrl:[""]}},delImg(){confirm("是否確定刪除圖片？")&&(this.temp.imageUrl="")},uploadFile(l){let t;l==="filtINput"?t=this.$refs[l].files[0]:t=this.$refs[l][0].files[0];const c=new FormData;c.append("file-to-upload",t),confirm("是否確定上傳檔案？")&&k.post(`${S}api/${N}/admin/upload`,c).then(r=>{l==="filtINput"?this.temp.imageUrl=r.data.imageUrl:(this.temp.imagesUrl[this.temp.imagesUrl.length-1]=r.data.imageUrl,console.log(this.temp.imagesUrl))}).catch(r=>{console.log(r)})},loading(){const l=this.$loading.show();this.loadingItem="loading",setTimeout(()=>{l.hide(),this.loadingItem=""},500)}},mounted(){this.productModal=new w(this.$refs.productModal)},props:["editProduct"]},O={class:"modal",tabindex:"-1",ref:"productModal"},R={class:"modal-dialog modal-xl"},$={class:"modal-header bg-dark text-white"},q={class:"modal-title"},B={key:0},H={key:1},j=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),G={class:"modal-body"},z={class:"row","g-2":""},J={class:"col-4"},K={class:"mb-5"},Q=e("label",{class:"form-label",for:"mainImg"},"主要圖片",-1),W=["src"],X=e("p",{class:"mb-3"},"細節圖片",-1),Y=["src"],Z=["onClick"],ee={class:"col-8"},te={class:"row"},oe={class:"mb-3"},se=e("label",{for:"productTitle",class:"form-label"},"標題",-1),le={class:"mb-3 col-md-6"},ne=e("label",{for:"productCat",class:"form-label"},"分類",-1),ie={class:"mb-3 col-md-6"},ae=e("label",{for:"productUnit",class:"form-label"},"單位",-1),de={class:"mb-3 col-md-6"},re=e("label",{for:"productOriginPrice",class:"form-label"},"原價",-1),ce={class:"mb-3 col-md-6"},me=e("label",{for:"productPrice",class:"form-label"},"售價",-1),ue={class:"mb-3"},pe=e("label",{for:"productDesc",class:"form-label"},"產品描述",-1),he={class:"mb-3"},ge=e("label",{for:"productContent",class:"form-label"},"說明內容",-1),_e={class:"mb-3"},be=e("label",{for:"productEnable",class:"form-label"},"是否啟用",-1),fe={class:"modal-footer"},Me=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),ve=["disabled"];function ye(l,t,c,r,o,m){const p=u("v-field"),h=u("v-error-message"),y=u("v-form");return i(),a("div",O,[e("div",R,[n(y,{class:"modal-content",onSubmit:t[12]||(t[12]=s=>c.editProduct(o.temp))},{default:x(()=>[e("div",$,[e("h5",q,[o.temp.id?(i(),a("span",H,"編輯產品")):(i(),a("span",B,"新增產品"))]),j]),e("div",G,[e("div",z,[e("div",J,[e("div",K,[Q,e("img",{src:o.temp.imageUrl,alt:"",class:"img-fluid mb-2"},null,8,W),o.temp.imageUrl?(i(),a("button",{key:0,type:"button",class:"btn btn-outline-danger mb-3 w-100",onClick:t[0]||(t[0]=(...s)=>m.delImg&&m.delImg(...s))},"刪除圖片")):(i(),a("input",{key:1,type:"file",class:"form-control",id:"mainImg",onChange:t[1]||(t[1]=s=>m.uploadFile("filtINput")),ref:"filtINput"},null,544))]),X,(i(!0),a(v,null,C(o.temp.imagesUrl,(s,g)=>(i(),a("div",{class:"mb-2",key:"img"+g},[s.length===0?(i(),a("input",{key:0,type:"file",class:"form-control",id:"spareImg",onChange:t[2]||(t[2]=d=>m.uploadFile("spareInput")),ref_for:!0,ref:"spareInput"},null,544)):b("",!0),e("img",{src:o.temp.imagesUrl[g],alt:"",class:"img-fluid mb-1"},null,8,Y),o.temp.imagesUrl[g].length?(i(),a("button",{key:1,type:"button",class:"btn btn-outline-danger mb-3 w-100",onClick:d=>o.temp.imagesUrl.splice(g,1)},"刪除圖片",8,Z)):b("",!0)]))),128)),Array.isArray(o.temp.imagesUrl)?(i(),a(v,{key:0},[o.temp.imagesUrl.length===0||o.temp.imagesUrl[o.temp.imagesUrl.length-1]?(i(),a("button",{key:0,type:"button",class:"btn btn-outline-primary",onClick:t[3]||(t[3]=s=>o.temp.imagesUrl.push(""))},"新增圖片")):b("",!0)],64)):b("",!0)]),e("div",ee,[e("div",te,[e("div",oe,[se,n(p,{type:"text",id:"productTitle",class:"form-control",placeholder:"請輸入標題",modelValue:o.temp.title,"onUpdate:modelValue":t[4]||(t[4]=s=>o.temp.title=s),name:"標題",rules:"required"},null,8,["modelValue"]),n(h,{name:"標題",class:"text-danger"})]),e("div",le,[ne,n(p,{type:"text",id:"productCat",class:"form-control",placeholder:"請輸入分類",modelValue:o.temp.category,"onUpdate:modelValue":t[5]||(t[5]=s=>o.temp.category=s),name:"分類",rules:"required"},null,8,["modelValue"]),n(h,{name:"分類",class:"text-danger"})]),e("div",ie,[ae,n(p,{type:"text",id:"productUnit",class:"form-control",placeholder:"請輸入單位",modelValue:o.temp.unit,"onUpdate:modelValue":t[6]||(t[6]=s=>o.temp.unit=s),name:"單位",rules:"required"},null,8,["modelValue"]),n(h,{name:"單位",class:"text-danger"})]),e("div",de,[re,n(p,{type:"number",id:"productOriginPrice",class:"form-control",placeholder:"請輸入原價",modelValue:o.temp.origin_price,"onUpdate:modelValue":t[7]||(t[7]=s=>o.temp.origin_price=s),modelModifiers:{number:!0},name:"原價",rules:"required|min_value:1",min:"1"},null,8,["modelValue"]),n(h,{name:"原價",class:"text-danger"})]),e("div",ce,[me,n(p,{type:"number",id:"productPrice",class:"form-control",placeholder:"請輸入售價",modelValue:o.temp.price,"onUpdate:modelValue":t[8]||(t[8]=s=>o.temp.price=s),modelModifiers:{number:!0},name:"售價",rules:"required|min_value:1",min:"1"},null,8,["modelValue"]),n(h,{name:"售價",class:"text-danger"})]),e("div",ue,[pe,P(e("textarea",{type:"text",id:"productDesc",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":t[9]||(t[9]=s=>o.temp.description=s)},null,512),[[U,o.temp.description]])]),e("div",he,[ge,P(e("textarea",{type:"text",id:"productContent",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":t[10]||(t[10]=s=>o.temp.content=s)},null,512),[[U,o.temp.content]])]),e("div",_e,[P(e("input",{type:"checkbox",id:"productEnable",class:"form-check-input me-2","onUpdate:modelValue":t[11]||(t[11]=s=>o.temp.is_enabled=s)},null,512),[[A,o.temp.is_enabled]]),be])])])])]),e("div",fe,[Me,e("button",{class:"btn btn-primary",disabled:o.loadingItem.length},"確認",8,ve)])]),_:1})])],512)}const Pe=V(F,[["render",ye]]),{VITE_API:f,VITE_PATH:M}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"sophiee22",BASE_URL:"/vue-live-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Ue={data(){return{products:[],pagination:{},productModal:{},alertModal:{},MessageModal:{},isLoading:!1,fullPage:!0}},components:{AlertModalComponent:D,productModalComponent:Pe,MessageModalComponent:E,PaginationComponent:L},watch:{isLoading(){setTimeout(()=>{this.isLoading=!1},500)}},methods:{getProducts(l=1){this.isLoading=!0,this.$http.get(`${f}api/${M}/admin/products?page=${l}`).then(t=>{this.$router.push(`/admin/products/${l}`),this.products=t.data.products,this.pagination=t.data.pagination}).catch(t=>{this.MessageModal.showMessage("無法取得產品列表")})},delProduct(l){this.isLoading=!0,this.$http.delete(`${f}api/${M}/admin/product/${l}`).then(()=>{this.alertModal.hideAlert(),this.MessageModal.showMessage("已刪除產品"),this.getProducts()}).catch(()=>{this.MessageModal.showMessage("無法刪除產品")})},editProduct(l){var r;this.isLoading=!0;let t="post",c=`${f}/api/${M}/admin/product`;(r=this.temp)!=null&&r.id&&(t="put",c=`${f}/api/${M}/admin/product/${this.temp.id}`),this.$http[t](c,{data:l}).then(()=>{this.productModal.hideProductModal(),this.getProducts()}).catch(o=>{this.MessageModal.showMessage("無法編輯產品")})}},mounted(){this.getProducts(this.$route.params.pageid),this.productModal=this.$refs.productModal,this.alertModal=this.$refs.alertModal,this.MessageModal=this.$refs.MessageModal}},Ve={class:"d-flex justify-content-end my-4"},Ce={key:0,class:"table"},Ie=e("thead",null,[e("tr",null,[e("th",null,"分類"),e("th",null,"產品名稱"),e("th",null,"原價"),e("th",null,"售價"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),ke={class:"btn-group"},we=["onClick"],xe=["onClick"],Ae={class:"d-flex justify-content-center"};function Ee(l,t,c,r,o,m){const p=u("loading"),h=u("MessageModalComponent"),y=u("AlertModalComponent"),s=u("productModalComponent"),g=u("PaginationComponent");return i(),a(v,null,[n(p,{active:o.isLoading,"onUpdate:active":t[0]||(t[0]=d=>o.isLoading=d),"is-full-page":o.fullPage},null,8,["active","is-full-page"]),n(h,{ref:"MessageModal"},null,512),n(y,{onEmitDeldata:m.delProduct,ref:"alertModal"},null,8,["onEmitDeldata"]),n(s,{ref:"productModal","edit-product":m.editProduct},null,8,["edit-product"]),e("div",Ve,[e("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=d=>o.productModal.showProductModal())},"建立新產品")]),o.products?(i(),a("table",Ce,[Ie,e("tbody",null,[(i(!0),a(v,null,C(o.products,d=>(i(),a("tr",{key:d.id},[e("td",null,_(d.category),1),e("td",null,_(d.title),1),e("td",null,_(d.origin_price),1),e("td",null,_(d.price),1),e("td",{class:T({"text-success":d.is_enabled})},_(d.is_enabled?"啟用":"未啟用"),3),e("td",null,[e("div",ke,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:I=>o.productModal.showProductModal(d)},"編輯",8,we),e("button",{type:"button",class:"btn btn-outline-danger",onClick:I=>o.alertModal.showAlert(d)},"刪除",8,xe)])])]))),128))])])):b("",!0),e("div",Ae,[n(g,{pagination:o.pagination,onGetpage:m.getProducts},null,8,["pagination","onGetpage"])])],64)}const Se=V(Ue,[["render",Ee]]);export{Se as default};
