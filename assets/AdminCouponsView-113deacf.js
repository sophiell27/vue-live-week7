import{_ as y,h as T,M as D,a as i,o as d,c as u,b as t,d as o,w,i as A,v as x,F as M,m as E,j as P,k,t as _,p as I}from"./index-809a14e8.js";import{A as L}from"./AlertModalComponent-e6abdb65.js";const{VITE_API:b,VITE_PATH:C}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"sophiee22",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},$={data(){return{isLoading:!1,fullPage:!0,messageModal:{},couponModal:{},coupon:{is_enabled:!1},dueDate:""}},watch:{isLoading(){setTimeout(()=>{this.isLoading=!1},500)}},mounted(){this.couponModal=new T(this.$refs.couponModal),this.messageModal=this.$refs.messageModal},methods:{showCouponModal(l={data:{is_enabled:!1}}){if(this.coupon={...l},this.coupon.due_date){const e=new Date(this.coupon.due_date*1e3).toISOString().split("T")[0];this.dueDate=e}this.couponModal.show()},editCoupon(l){this.isLoading=!0;let e=Math.floor(new Date(this.dueDate)/1e3);this.coupon.due_date=e,l.is_enabled?l.is_enabled=1:l.is_enabled=0;let r="post",m=`${b}api/${C}/admin/coupon`;this.coupon.id&&(r="put",m=`${b}api/${C}/admin/coupon/${this.coupon.id}`),this.$http[r](m,{data:l}).then(()=>{this.couponModal.hide(),this.$emit("getCoupons"),setTimeout(()=>{this.messageModal.showMessage("已更新優惠劵")},1e3),this.coupon={is_enabled:!1},this.dueDate=""}).catch(s=>{this.messageModal.showMessage("無法更新優惠劵")})}},components:{MessageModalComponent:D},emits:["getCoupons"]},S={class:"modal",tabindex:"-1",ref:"couponModal"},U={class:"modal-dialog"},R={class:"modal-content"},B={class:"modal-header"},H={class:"modal-title"},O={key:0},q={key:1},j=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),F={class:"modal-body"},G={class:"mb-3"},N=o("label",{for:"couponTitle",class:"form-label"},"標題",-1),z={class:"mb-3"},J=o("label",{for:"couponCode"},"優惠碼",-1),K={class:"mb-3"},Q=o("label",{for:"couponDue",class:"form-label"},"到期日",-1),W={class:"mb-3"},X=o("label",{for:"couponPercent",class:"form-label"},"折扣百分比",-1),Y={class:"mb-3"},Z=o("label",{for:"couponStatus",class:"form-label"},"是否啟用",-1),oo={class:"modal-footer"},eo=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1),so={class:"btn btn-primary"},to={key:0},no={key:1};function lo(l,e,r,m,s,h){const g=i("loading"),f=i("MessageModalComponent"),c=i("v-field"),p=i("v-error-message"),a=i("v-form");return d(),u(M,null,[t(g,{active:s.isLoading,"onUpdate:active":e[0]||(e[0]=n=>s.isLoading=n),"is-full-page":s.fullPage},null,8,["active","is-full-page"]),t(f,{ref:"messageModal"},null,512),o("div",S,[o("div",U,[o("div",R,[o("div",B,[o("h5",H,[s.coupon.id?(d(),u("span",O,"編輯優惠卷")):(d(),u("span",q,"新增優惠卷"))]),j]),t(a,{onSubmit:e[6]||(e[6]=n=>h.editCoupon(s.coupon))},{default:w(()=>[o("div",F,[o("div",G,[N,t(c,{type:"text",id:"couponTitle",name:"標題",class:"form-control",placeholder:"請輸入標題",modelValue:s.coupon.title,"onUpdate:modelValue":e[1]||(e[1]=n=>s.coupon.title=n),rules:"required"},null,8,["modelValue"]),t(p,{class:"text-danger",name:"標題"})]),o("div",z,[J,t(c,{type:"text",id:"couponCode",name:"優惠碼",class:"form-control",placeholder:"請輸入優惠碼",modelValue:s.coupon.code,"onUpdate:modelValue":e[2]||(e[2]=n=>s.coupon.code=n),rules:"required"},null,8,["modelValue"]),t(p,{class:"text-danger",name:"優惠碼"})]),o("div",K,[Q,t(c,{id:"couponDue",name:"到期日",class:"form-control",placeholder:"請輸入到期日",modelValue:s.dueDate,"onUpdate:modelValue":e[3]||(e[3]=n=>s.dueDate=n),type:"date",rules:"required"},null,8,["modelValue"]),t(p,{class:"text-danger",name:"到期日"})]),o("div",W,[X,t(c,{type:"number",id:"couponPercent",name:"折扣百分比",class:"form-control",placeholder:"請輸入折扣百分比",modelValue:s.coupon.percent,"onUpdate:modelValue":e[4]||(e[4]=n=>s.coupon.percent=n),modelModifiers:{number:!0},min:"1",max:"99",rules:"required|max_value:100|min_value: 1"},null,8,["modelValue"]),t(p,{class:"text-danger",name:"折扣百分比"})]),o("div",Y,[A(o("input",{type:"checkbox",id:"couponStatus",name:"",class:"form-check-input me-2",placeholder:"請輸入是否啟用","onUpdate:modelValue":e[5]||(e[5]=n=>s.coupon.is_enabled=n)},null,512),[[x,s.coupon.is_enabled]]),Z])]),o("div",oo,[eo,o("button",so,[s.coupon.id?(d(),u("span",to,"編輯優惠劵")):(d(),u("span",no,"新增優惠劵"))])])]),_:1})])])],512)],64)}const ao=y($,[["render",lo]]),{VITE_API:v,VITE_PATH:V}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"sophiee22",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},io={data(){return{isLoading:!1,fullPage:!0,messageModal:{},alertModal:{},couponModal:{},coupons:{}}},components:{CouponModalComponent:ao,MessageModalComponent:D,AlertModalComponent:L},watch:{isLoading(){setTimeout(()=>{this.isLoading=!1},1e3)}},mounted(){this.couponModal=this.$refs.couponModal,this.messageModal=this.$refs.messageModal,this.alertModal=this.$refs.alertModal,this.getCoupons()},methods:{...E(k,["getDate"]),getCoupons(){this.isLoading=!0,this.$http.get(`${v}api/${V}/admin/coupons`).then(l=>{this.coupons={...l.data.coupons},this.messageModal.showMessage("取得優惠券列表")}).catch(()=>{this.messageModal.showMessage("無法取得優惠券列表")})},delCoupon(l){this.isLoading=!0,this.$http.delete(`${v}api/${V}/admin/coupon/${l}`).then(e=>{this.alertModal.hideAlert(),this.getCoupons(),this.messageModal.showMessage("已刪除優惠券")}).catch(e=>{this.messageModal.showMessage("無法刪除優惠券")})}}},uo={class:"d-flex justify-content-end"},co={class:"table"},po=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1),ro={class:"btn-group"},mo=["onClick"],ho=["onClick"];function _o(l,e,r,m,s,h){const g=i("loading"),f=i("AlertModalComponent"),c=i("MessageModalComponent"),p=i("CouponModalComponent");return d(),u(M,null,[t(g,{active:s.isLoading,"onUpdate:active":e[0]||(e[0]=a=>s.isLoading=a),"is-full-page":s.fullPage},null,8,["active","is-full-page"]),t(f,{ref:"alertModal",onEmitDeldata:h.delCoupon},null,8,["onEmitDeldata"]),t(c,{ref:"messageModal"},null,512),t(p,{ref:"couponModal",onGetCoupons:h.getCoupons},null,8,["onGetCoupons"]),o("div",uo,[o("button",{type:"button",class:"btn btn-primary my-4",onClick:e[1]||(e[1]=a=>s.couponModal.showCouponModal())},"建立新的優惠券")]),o("table",co,[po,o("tbody",null,[(d(!0),u(M,null,P(s.coupons,a=>(d(),u("tr",{key:a.id},[o("td",null,_(a.title),1),o("td",null,_(a.percent)+" %",1),o("td",null,_(l.getDate(a.due_date)),1),o("td",{class:I({"text-success":a.is_enabled})},_(a.is_enabled?"啟用":"未啟用"),3),o("td",null,[o("div",ro,[o("button",{type:"button",class:"btn btn-outline-primary",onClick:n=>s.couponModal.showCouponModal(a)},"編輯",8,mo),o("button",{type:"button",class:"btn btn-outline-danger",onClick:n=>this.alertModal.showAlert(a)},"刪除",8,ho)])])]))),128))])])],64)}const Mo=y(io,[["render",_o]]);export{Mo as default};
