import{_ as b,h as P,o as d,c as r,d as e,t as o,i as f,v,f as $,m as A,M as D,a as c,b as h,F as m,j as M,k as E}from"./index-60674962.js";import{P as V}from"./PaginationComponent-ebeaa653.js";import{A as L}from"./AlertModalComponent-5240205d.js";const x={data(){return{orderModal:{},order:{}}},methods:{showOrderModal(s){this.order={...s},this.orderModal.show()},hideOrderModal(){this.orderModal.hide(),this.order={}}},mounted(){this.orderModal=new P(this.$refs.orderModal)},props:["getDate"],emits:["change-order"]},T={class:"modal",tabindex:"-1",ref:"orderModal"},I={class:"modal-dialog modal-xl"},S={class:"modal-content"},U=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"訂單細節"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),B={key:0,class:"modal-body"},N={class:"row"},R={class:"col-lg-4"},j=e("h2",null,"用戶資料",-1),F={class:"table"},G=e("th",null,"姓名",-1),H=e("th",null,"Email",-1),q=e("th",null,"電話",-1),z=e("th",null,"地址",-1),J={class:"col-lg-8"},K=e("h2",{class:"mb-3"},"訂單細節",-1),Q={class:"table mb-4"},W=e("th",null,"訂單編號",-1),X=e("th",null,"下單時間",-1),Y=e("th",null,"付款時間",-1),Z=e("th",null,"付款狀態",-1),ee=e("th",null,"總金額",-1),te=e("h2",{class:"mb-3"},"選購商品",-1),oe=e("table",{class:"table"},[e("tbody",null,[e("tr",null,[e("th",null,"姓名"),e("td")])])],-1),se=["value"],le={for:"paystatus"},ne={class:"modal-footer"},de=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1);function re(s,l,_,y,t,i){return d(),r("div",T,[e("div",I,[e("div",S,[U,t.order.id?(d(),r("div",B,[e("div",N,[e("div",R,[j,e("table",F,[e("tbody",null,[e("tr",null,[G,e("td",null,o(t.order.user.name),1)]),e("tr",null,[H,e("td",null,o(t.order.user.email),1)]),e("tr",null,[q,e("td",null,o(t.order.user.tel),1)]),e("tr",null,[z,e("td",null,o(t.order.user.address),1)])])])]),e("div",J,[K,e("table",Q,[e("tbody",null,[e("tr",null,[W,e("td",null,o(t.order.id),1)]),e("tr",null,[X,e("td",null,o(_.getDate(t.order.create_at)),1)]),e("tr",null,[Y,e("td",null,o(t.order.is_paid?_.getDate(t.order.create_at):"N/A"),1)]),e("tr",null,[Z,e("td",null,o(t.order.is_paid?"已付款":"未付款"),1)]),e("tr",null,[ee,e("td",null,o(t.order.total),1)])])]),te,oe,f(e("input",{type:"checkbox",id:"paystatus",class:"form-checkinput me-2","onUpdate:modelValue":l[0]||(l[0]=u=>t.order.is_paid=u),value:t.order.is_paid},null,8,se),[[v,t.order.is_paid]]),e("label",le,o(t.order.is_paid?"已付款":"未付款"),1)])])])):$("",!0),e("div",ne,[de,e("button",{type:"button",class:"btn btn-primary",onClick:l[1]||(l[1]=u=>s.$emit("change-order",t.order))},"修改付款狀態")])])])],512)}const ae=b(x,[["render",re]]),{VITE_API:p,VITE_PATH:g}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"sophiee22",BASE_URL:"/vue-live-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},ie={data(){return{orders:[],orderPagination:{},orderModal:{},messageModal:{},alertModal:{},isLoading:!1,fullPage:!0}},watch:{isLoading(){setTimeout(()=>{this.isLoading=!1},500)}},methods:{...A(E,["getDate"]),getorders(s=1){this.isLoading=!0,this.$http.get(`${p}api/${g}/admin/orders?page=${s}`).then(l=>{this.orders=l.data.orders,this.orderPagination=l.data.pagination,this.$router.push(`/admin/orders/${s}`)}).catch(()=>!1)},changeStatus(){order.is_paid=!order.is_paid},changeOrder(s){this.isLoading=!0,this.$http.put(`${p}api/${g}/admin/order/${s.id}`,{data:s}).then(l=>{this.orderModal.hideOrderModal(),this.messageModal.showMessage("成功更改付款狀態"),this.getorders()}).catch(l=>{this.messageModal.showMessage("無法更改付款狀態")})},delOrder(s){this.isLoading=!0,this.$http.delete(`${p}api/${g}/admin/order/${s}`).then(()=>{this.alertModal.hideAlert(),this.messageModal.showMessage("已刪除訂單"),this.getorders()}).catch(l=>{this.messageModal.showMessage("無法刪除訂單")})}},components:{MessageModalComponent:D,PaginationComponent:V,AlertModalComponent:L,OrderModalComponent:ae},mounted(){this.getorders(this.$route.params.orderpageid),this.orderModal=this.$refs.orderModal,this.messageModal=this.$refs.messageModal,this.alertModal=this.$refs.alertModal}},ce={key:0,class:"text-danger"},he={key:1,class:"table"},ue=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額 "),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),_e={class:"form-check form-switch"},me=["onUpdate:modelValue","onChange"],pe={class:"form-check-label",for:"orderPay"},ge={class:"btn-group"},Me=["onClick"],be=["onClick"],fe={class:"d-flex justify-content-center"};function ve(s,l,_,y,t,i){const u=c("loading"),C=c("MessageModalComponent"),k=c("OrderModalComponent"),O=c("AlertModalComponent"),w=c("PaginationComponent");return d(),r(m,null,[h(u,{active:t.isLoading,"onUpdate:active":l[0]||(l[0]=n=>t.isLoading=n),"is-full-page":t.fullPage},null,8,["active","is-full-page"]),h(C,{ref:"messageModal"},null,512),h(k,{ref:"orderModal","get-date":s.getDate,onChangeOrder:i.changeOrder},null,8,["get-date","onChangeOrder"]),h(O,{ref:"alertModal",onEmitDeldata:i.delOrder},null,8,["onEmitDeldata"]),t.orders.length?(d(),r("table",he,[ue,e("tbody",null,[(d(!0),r(m,null,M(t.orders,n=>(d(),r("tr",null,[e("td",null,o(s.getDate(n.create_at)),1),e("td",null,o(n.user.email),1),e("td",null,[(d(!0),r(m,null,M(n.products,a=>(d(),r("p",null,o(a.product.title)+" / "+o(a.qty),1))),256))]),e("td",null,"$ "+o(n.total),1),e("td",null,[e("div",_e,[f(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"orderPay","onUpdate:modelValue":a=>n.is_paid=a,onChange:a=>i.changeOrder(n)},null,40,me),[[v,n.is_paid]]),e("label",pe,o(n.is_paid?"已付款":"末付款"),1)])]),e("td",null,[e("div",ge,[e("button",{type:"button",class:"btn btn-outline-primary",onClick:a=>t.orderModal.showOrderModal(n)},"檢視",8,Me),e("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>t.alertModal.showAlert(n)},"刪除",8,be)])])]))),256))])])):(d(),r("p",ce,"沒有任何訂單")),e("div",fe,[h(w,{pagination:t.orderPagination,onGetpage:i.getorders},null,8,["pagination","onGetpage"])])],64)}const Oe=b(ie,[["render",ve]]);export{Oe as default};
